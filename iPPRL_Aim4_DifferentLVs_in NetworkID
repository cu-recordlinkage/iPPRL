/* SQL snippet that determines if all LV values within a network_id are the same or different
cteDummy is an example with three LVs.
Includes NULL as a value
*/

with cteDummy as (
    select
        1 as NetworkID, 'a' as Lv1, 'a' as Lv2, 'a' as Lv3
    union all
    select 1, 'a', 'b', 'b'
    union all
    select 1, 'a','a', 'c'
    union all
    select 1, 'a','a','d'
    union all
    select 2, 'x','y','s'
    union all
    select 2, 'z','y', null
    union all
    select 3, null, null, 'z'
    union all
    select 3, 'x', null, null

)
select cte.NetworkID
    , case when count (distinct coalesce(cte.Lv1,'zzz')) = 1 then 'same' else 'different' end as Lv1Flag
    , case when count (distinct coalesce(cte.Lv2,'zzz')) = 1 then 'same' else 'different' end as Lv2Flag
    , case when count (distinct coalesce(cte.Lv3,'zzz')) = 1 then 'same' else 'different' end as Lv3Flag
from
    cteDummy cte
group by 
    cte.NetworkID
order by
    cte.NetworkId
;


with cteDummy as (
    select
        1 as NetworkID, 'a' as Lv1, 'a' as Lv2, 'a' as Lv3
    union all
    select 1, 'a', 'b', 'b'
    union all
    select 1, 'a','a', 'c'
    union all
    select 1, 'a','a','d'
    union all
    select 2, 'x','y','s'
    union all
    select 2, 'z','y', null
    union all
    select 3, null, null, 'z'
    union all
    select 3, 'x', null, null

)
select * from cteDummy;